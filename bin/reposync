#!/usr/bin/env bash

if [[ $# -eq 2 ]]; then
    echo >&2 "${0##*/}: NAME URL"
    exit 1
fi

name="$1"
url="$2"

# Create yum configuration
cat << EOF > "/etc/yum.repos.d/${name}.repo"
[${name}]
name=${name}
baseurl=${url}
enabled=1
gpgcheck=0
EOF

set -ex

# Sync repo
dnf reposync --repoid "${name}" \
    --download-path "${DOWNLOAD_PATH:-/data}" \
    --downloadcomps \
    --download-metadata \
    --delete \
    --remote-time
